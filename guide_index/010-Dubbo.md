# Dubbo

> 第七人格

## Dubbo⽀持哪些负载均衡策略

1. 随机：从多个服务提供者随机选择⼀个来处理本次请求，调⽤量越⼤则分布越均匀，并⽀持按权重设置随机概率
2. 轮询：依次选择服务提供者来处理请求， 并⽀持按权重进⾏轮询，底层采⽤的是平滑加权轮询算法
3. 最⼩活跃调⽤数：统计服务提供者当前正在处理的请求，下次请求过来则交给活跃数最⼩的服务器来处理
4. ⼀致性哈希：相同参数的请求总是发到同⼀个服务提供者

## Dubbo是如何完成服务导出的？

1. ⾸先Dubbo会将程序员所使⽤的@DubboService注解或@Service注解进⾏解析得到程序员所定义的服务参数，包括定义的服务名、服务接⼝、服务超时时间、服务协议等等，得到⼀个ServiceBean。
2. 然后调⽤ServiceBean的export⽅法进⾏服务导出
3. 然后将服务信息注册到注册中⼼，如果有多个协议，多个注册中⼼，那就将服务按单个协议，单个注册中⼼进⾏注册
4. 将服务信息注册到注册中⼼后，还会绑定⼀些监听器，监听动态配置中⼼的变更
5. 还会根据服务协议启动对应的Web服务器或⽹络框架，⽐如Tomcat、Netty等

## Dubbo是如何完成服务引⼊的？

1. 当程序员使⽤@Reference注解来引⼊⼀个服务时，Dubbo会将注解和服务的信息解析出来，得到当前所引⽤的服务名、服务接⼝是什么
2. 然后从注册中⼼进⾏查询服务信息，得到服务的提供者信息，并存在消费端的服务⽬录中
3. 并绑定⼀些监听器⽤来监听动态配置中⼼的变更
4. 然后根据查询得到的服务提供者信息⽣成⼀个服务接⼝的代理对象，并放⼊Spring容器中作为Bean

## 什么是泛化调用，你有使用过dubbo泛化调用吗？
泛化调用是指在消费者没有生产者提供的api的情况下，调用生产者接口的过程。

在网关服务中，我们使用了dubbo泛化调用，主要是用于协议转换，将外部http协议，转换成内部dubbo协议。

使用dubbo泛化大致分为3板斧

1、创建服务实例

2、获取缓存中的实例

3、使用$invoke调用方法

这里特别要注意第二步，千万不要使用官方示例中直接获取实例的方法，那样会导致每次调用都是获取的新的实例，最终导致zookeeper宕机。